!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@popetech/ngx-rest-model",["exports","@angular/core","@angular/common/http","rxjs/operators"],e):e(((t=t||self).popetech=t.popetech||{},t.popetech["ngx-rest-model"]={}),t.ng.core,t.ng.common.http,t.rxjs.operators)}(this,(function(t,e,o,r){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var n=function(){return(n=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function i(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var p=t.length-1;p>=0;p--)(n=t[p])&&(a=(i<3?n(a):i>3?n(e,o,a):n(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a}function a(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function p(t){var e="function"==typeof Symbol&&t[Symbol.iterator],o=0;return e?e.call(t):{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}}var s=new e.InjectionToken("config"),u=function(){function t(t,e){this.http=t;var o=e.api_root;this.setBaseUrl(o),this.setApiRoot(o)}var n,p;return t.prototype.setBaseUrl=function(t){this.baseUrl=t},t.prototype.getBaseUrl=function(){return this.baseUrl},t.prototype.setApiRoot=function(t){this.apiRoot=t},t.prototype.getApiRoot=function(){return this.apiRoot},t.prototype.getUrl=function(t,e){return void 0===e&&(e=!1),e?this.getApiRoot()+"/"+t:this.getBaseUrl()+"/"+t},t.prototype.get=function(t,e,o){void 0===e&&(e={}),void 0===o&&(o=!1);var n=this.getUrl(t,o);return e!={}?this.http.get(n,e).pipe(r.take(1)):this.http.get(n).pipe(r.take(1))},t.prototype.post=function(t,e,o,n){void 0===o&&(o=!1),void 0===n&&(n={});var i=this.getUrl(t,o);return n!={}?this.http.post(i,e,n).pipe(r.take(1)):this.http.post(i,e).pipe(r.take(1))},t.prototype.put=function(t,e,o){void 0===o&&(o=!1);var n=this.getUrl(t,o);return this.http.put(n,e).pipe(r.take(1))},t.prototype.delete=function(t,e,o){void 0===e&&(e={}),void 0===o&&(o=!1);var n=this.getUrl(t,o);return this.http.delete(n).pipe(r.take(1))},t.ctorParameters=function(){return[{type:o.HttpClient},{type:void 0,decorators:[{type:e.Inject,args:[s]}]}]},t=i([e.Injectable(),(n=1,p=e.Inject(s),function(t,e){p(t,e,n)}),a("design:paramtypes",[o.HttpClient,Object])],t)}(),l=function(){function t(){}return t.add=function(e){var o=(new e).constructor.name.toLowerCase();t.models[o]||(t.models[o]=e)},t.get=function(e){return t.models[e]},t.models={},t}(),c=function(){function t(){this.modelConfig={key:"",uri:"",hidden:[],relationships:{}}}return t.prototype.setConfig=function(t){this.modelConfig=n(n({},this.getConfig()),t)},t.prototype.getConfig=function(){return this.modelConfig},t.prototype.getUri=function(){return this.modelConfig.uri},t.prototype.getSelfUri=function(){return this.modelConfig.uri+"/"+this[this.modelConfig.key]},t.prototype.setUri=function(t){this.modelConfig.uri=t},t.prototype.getKey=function(){return this.modelConfig.key},t.prototype.getRelationship=function(t){return this.modelConfig.relationships[t]},t.prototype.deserialize=function(t){var e,o,r=this.getConfig(),n=[];for(var i in t)t.hasOwnProperty(i)&&(r.hidden.indexOf(i)>-1||("object"!=typeof t[i]?this[this.snakeToCamel(i)]=t[i]:r.relationships.hasOwnProperty(this.snakeToCamel(i))&&n.push({key:this.snakeToCamel(i),value:t[i]?t[i].data:null})));try{for(var a=p(n),s=a.next();!s.done;s=a.next()){var u=s.value;if(null!==u.value){var c=r.relationships[u.key],h=l.get(c.model),g=new f(this,h,c.type);this[u.key]=d.makeRelatedFromRelationship(g,u.value)}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(e)throw e.error}}return this},t.prototype.snakeToCamel=function(t){return t.replace(/_\w/g,(function(t){return t[1].toUpperCase()}))},t}(),f=function(){function t(t,e,o){this.model=t,this.related=e,this.type=o}return t.prototype.setRelated=function(t){this.related=t},t.prototype.getRelated=function(){return this.related},t.prototype.setModel=function(t){this.model=t},t.prototype.create=function(){return this.related instanceof c||(this.related=new this.related),"hasMany"==this.type||"hasOne"==this.type?(this.related.setUri(this.model.getSelfUri()+"/"+this.related.getUri()),this.related):"belongsTo"==this.type?this.related:void 0},t.prototype.getModel=function(){},t.prototype.getUri=function(){},t}(),d=function(){function t(){}return t.make=function(t,e){return(new t).deserialize(e)},t.makeFromArray=function(t,e){for(var o=[],r=0;r<e.length;++r)o.push((new t).deserialize(e[r]));return o},t.makeRelated=function(t,e,o){var r=t.getRelationship(o),n=new f(t,e,r.type);return t[o]=n.create(),t.setUri(t[o].getSelfUri()+"/"+t.getUri()),t},t.makeRelatedFromRelationship=function(e,o){if("hasOne"==e.type||"belongsTo"==e.type)return e.create().deserialize(o);if("hasMany"==e.type){var r=e.getRelated();return t.makeFromArray(r,o)}},t}(),h=function(){function t(t){this.api=t}return t.prototype.setModel=function(t){this.model=t},t.prototype.find=function(t){var e=this,o=l.get(this.model.key);return this.api.get((new o).getUri()+"/"+t).pipe(r.map((function(t){return t.data=d.make(l.get(e.model.key),t.data),t})))},t.prototype.save=function(t){return t[t.getKey()]?this.update(t):this.createNew(t)},t.prototype.update=function(t){var e=t.serialize();return this.api.put(t.getUri()+"/"+t[t.getKey()],e)},t.prototype.createNew=function(t){var e=t.serialize();return this.api.post(t.getUri(),e)},t.prototype.destroy=function(t){return this.api.delete(t.getUri()+"/"+t[t.getKey()])},t.prototype.get=function(t,e){var n=this;void 0===t&&(t=null),void 0===e&&(e={page:1});var i={params:new o.HttpParams};return 1!=e.page&&(i.params=(new o.HttpParams).set("page",String(e.page))),(null===t?this.api.get((new this.model).getUri(),i):this.api.get(t.getUri(),i)).pipe(r.map((function(t){var e=t.data;return t.data=d.makeFromArray(l.get(n.model.key),e),t})))},t.prototype.getRelated=function(t,e,o,r){void 0===o&&(o=null),void 0===r&&(r={}),null==o&&(o=this.model);var n=l.get(o.key);return o=d.makeRelated(new n,t,e),this.get(o)},t.ctorParameters=function(){return[{type:u}]},t=i([e.Injectable(),a("design:paramtypes",[u])],t)}(),g=function(){function t(){}var o;return o=t,t.forRoot=function(t){return{ngModule:o,providers:[{provide:s,useValue:t}]}},t=o=i([e.NgModule({imports:[],declarations:[],exports:[],providers:[u,h]})],t)}();t.ApiService=u,t.BackendService=h,t.BaseModel=c,t.ModelFactory=d,t.Models=l,t.NgxRestModelModule=g,t.Relationship=f,t.Éµa=s,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=popetech-ngx-rest-model.umd.min.js.map